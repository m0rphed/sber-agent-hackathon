from collections.abc import Callable
import json
from typing import Any

from rich import print as rprint
from rich.console import Console
from rich.json import JSON as RichJSON
from rich.panel import Panel

console = Console()


def log_api_response(name_method_function: str, url: str, params: dict | None = None) -> Callable:
    """
    –î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è API –æ—Ç–≤–µ—Ç–æ–≤
    """

    def decorator(func):
        async def wrapper(self, *args, **kwargs):
            # –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–º—è —Ñ—É–Ω–∫—Ü–∏–∏ –∏ URL
            console.rule(f'[bold cyan]üì° API Call: {name_method_function}[/bold cyan]')
            rprint(f'[dim]URL:[/dim] {url}')
            if params or kwargs:
                rprint(f'[dim]Params:[/dim] {params or kwargs}')
            result = await func(self, *args, **kwargs)
            return result

        return wrapper

    return decorator


# –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è rich –ø—Ä–∏–Ω—Ç–∞ –≤—Ö–æ–¥–∞ –∏ –≤—ã—Ö–æ–¥–∞ –ª—é–±–æ–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
# —Å –ª—é–±—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
def print_in_out(func: Callable) -> Callable:
    async def wrapper(*args, **kwargs) -> None:
        result = await func(*args, **kwargs)
        rprint('input args:', f'[yellow]{args}[/yellow]')
        rprint('input kwargs:', f'[bold]{kwargs}[/bold]')
        rprint('result:', result)

    return wrapper


def _log_json(title: str, data: Any, style: str = 'green') -> None:
    """
    –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ JSON —Å rich —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
    """
    json_str = json.dumps(data, ensure_ascii=False, indent=2, default=str)
    panel = Panel(
        RichJSON(json_str),
        title=f'[bold {style}]{title}[/bold {style}]',
        border_style=style,
        expand=False,
    )
    console.print(panel)


def _log_error(title: str, message: str) -> None:
    """
    –õ–æ–≥–∏—Ä—É–µ—Ç –æ—à–∏–±–∫—É
    """
    console.print(f'[bold red]- Error! {title}:[/bold red] {message}')


def _log_info(message: str) -> None:
    """
    –õ–æ–≥–∏—Ä—É–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    """
    console.print(f'[dim]- Info: {message}[/dim]')
